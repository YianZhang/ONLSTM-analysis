# ONLSTM Analysis

This repository contains the ONLSTM checkpoints and their parses analyzed in the paper Latent Tree Learning with Ordered Neurons: What Parses Does It Produce?

The repo is originally forked from [Ordered-Neurons](https://github.com/yikangshen/Ordered-Neurons) by Yikang Shen et al.

## ONLSTM Checkpoints and Parses

The 5 ONLSTM checkpoints can be downloaded [here](https://github.com/YianZhang/ONLSTM-analysis/blob/6a8e94ce46ffe545937657b25623e74284b0a3fd/ON-LSTM_Checkpoints-20250610T084440Z-1-001.zip).

The parses generated by these checkpoints can be found in [parse_results](parse_results).

To reproduce these checkpoints yourself, you need to:

1. Install PyTorch 0.4 and NLTK

2. Download PTB raw text data from [Penn Treebank corpus](https://github.com/pytorch/examples/tree/75e435f98ab7aaa7f82632d4e633e8e03070e8ac/word_language_model/data/penn).

3. Use the command: 
```python main.py --batch_size 20 --dropout 0.45 --dropouth 0.3 --dropouti 0.5 --wdrop 0.45 --chunk_size 10 --seed 141 --epochs 1000 --save ONLSTM-1.pt```

The random seeds we use are: 141, 494, 1998, 982, and 192.

* If you want to generate a parse using your own checkpoint, you will need to request [Penn Treebank Parsed](https://catalog.ldc.upenn.edu/LDC99T42) data, and use the command:
```python test_phrase_grammar.py --cuda```



## Random Baselines

The random baseline parses we use in the study can be found [here](random_parses).

To generate the random parses yourself, you need to:

1. Request [Penn Treebank Parsed](https://catalog.ldc.upenn.edu/LDC99T42) data.

2. Extract the raw texts and arrange them in the format of [wsj10_sample.txt](wsj10_sample.txt) and [wsjtest_sample.txt](wsjtest_sample.txt). We are only providing samples instead of the complete version of the formatted data because the source data are not publicly available without requesting.

3. Run the following command:
```python parse_by_baseline.py```

## F1-scores

To compute the F1 between two parses, use the following command:

```EVALB/evalb -p EVALB/COLLINS.prm parse_1 parse_2 >output```

## References

```
@article{shen2018ordered,
  title={Ordered Neurons: Integrating Tree Structures into Recurrent Neural Networks},
  author={Shen, Yikang and Tan, Shawn and Sordoni, Alessandro and Courville, Aaron},
  journal={arXiv preprint arXiv:1810.09536},
  year={2018}
}
```
